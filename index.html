<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Trouble Brewing Ablauf</title>

  <!-- Mystische Schriftarten -->
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Uncial+Antiqua&display=swap" rel="stylesheet">

  <style>
  body {
    font-family: 'Cinzel', serif;
    margin: 0;
    padding: 15px;
    background: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
    color: #f0e6d2;
    font-size: 16px;
    background-attachment: fixed;
    background-size: cover;
  }

  h1, h2, h3 {
    font-family: 'Uncial Antiqua', cursive;
    text-align: center;
    color: #d32f2f;
    text-shadow: 0 0 6px rgba(0,0,0,0.8);
  }
  h1 { font-size: 2em; margin-bottom: 20px; }
  h2 { font-size: 1.4em; margin: 10px 0; }
  h3 { font-size: 1.2em; }
  
  h2 {
  cursor: pointer;
}
h2.collapsed::after {
  content: " ‚ñ∫";
}
h2.expanded::after {
  content: " ‚ñº";
}

  button {
    font-family: 'Cinzel', serif;
    font-size: 16px;
    padding: 10px 16px;
    margin: 6px;
    border-radius: 10px;
    border: 2px solid #a11;
    background: linear-gradient(180deg, #b71c1c, #7f0000);
    color: #f8f8f8;
    cursor: pointer;
    box-shadow: 0 2px 6px rgba(0,0,0,0.6);
    transition: transform 0.15s, background 0.3s;
    min-height: 44px;
  }
  button:hover {
    background: linear-gradient(180deg, #d32f2f, #8b0000);
    transform: scale(1.05);
  }

  select, input, textarea {
    font-family: 'Cinzel', serif;
    font-size: 16px;
    margin: 6px 0;
    padding: 10px;
    width: 100%;
    border-radius: 8px;
    border: 1px solid #555;
    background: #222;
    color: #f0e6d2;
    box-sizing: border-box;
    min-height: 44px;
  }
  textarea {
    resize: vertical;
  }

  .runde-box, .notiz-box {
    margin: 15px 0;
    padding: 15px;
    background: rgba(30, 30, 30, 0.95);
    border-radius: 15px;
    border: 1px solid #444;
    box-shadow: 0 0 10px rgba(255,0,0,0.3);
  }

  .historie {
    margin-top: 25px;
    padding: 15px;
    background: rgba(20,20,20,0.9);
    border-radius: 15px;
    border: 1px solid #555;
    box-shadow: inset 0 0 10px rgba(200,0,0,0.2);
  }

	/* --- neue Styles f√ºr Charakterbuttons --- */
.charakter-button {
  display: inline-block;
  padding: 8px 12px;
  margin: 5px;
  border-radius: 8px;
  border: 2px solid #a11;
  background: linear-gradient(180deg, #333, #111);
  color: #f0e6d2;
  cursor: pointer;
  font-family: 'Cinzel', serif;
  font-size: 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.6);
  transition: all 0.2s ease-in-out;
  text-align: center;
  width: 100%;
}
.charakter-button:hover {
  transform: scale(1.05);
}
.charakter-button.ausgewaehlt {
  background: linear-gradient(180deg, #1b5e20, #2e7d32); /* gr√ºn */
  border-color: #2e7d32;
  color: #fff;
}


  /* Charakterauswahl kompakter */
  #charaktere-liste {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    gap: 6px 12px;
  }
  #charaktere-liste div {
    display: flex;
    align-items: center;
  }
  #charaktere-liste label {
    margin-left: 6px;
  }

  /* Aktionen kompakter */
  .aktion { 
    margin-bottom: 10px; 
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
  }
  .aktion select,
  .aktion input {
    flex: 1 1 45%;
    min-width: 120px;
    font-size: 14px;
    padding: 6px 8px;
    min-height: 32px;
  }
  .aktion button {
    flex: 0 0 auto;
    font-size: 14px;
    padding: 6px 10px;
    min-height: 32px;
    border-radius: 6px;
  }

  /* Mobile Optimierungen */
  @media (max-width: 600px) {
    body {
      font-size: 15px;
      padding: 8px;
    }
    h1 { font-size: 1.6em; }
    button {
      font-size: 15px;
      padding: 8px 12px;
      min-height: 38px;
    }
    .runde-box, .historie {
      padding: 10px;
    }
    .aktion {
      flex-direction: column;
      gap: 4px;
    }
    .aktion select,
    .aktion input {
      width: 100%;
      flex: unset;
      font-size: 13px;
      padding: 5px 6px;
      min-height: 30px;
    }
    .aktion button {
      font-size: 13px;
      padding: 5px 8px;
      min-height: 30px;
    }
  }
  
     /* Aktionen */
  .aktion {
    margin-bottom: 15px;
    padding: 10px;
    border-radius: 10px;
    background: rgba(50,50,50,0.7);
    border: 1px solid #555;
  }
  .aktion h4 {
    margin-top: 0;
    color: #f55;
    font-size: 1em;
    margin-bottom: 8px;
  }
  .aktion input {
    margin-bottom: 6px;
  }
  .del-btn {
    background: #444;
    color: #ccc;
    border: none;
    font-size: 14px;
    padding: 4px 8px;
    margin-top: 6px;
    border-radius: 6px;
    cursor: pointer;
  }
  .del-btn:hover {
    background: #666;
    color: #fff;
  }
  
  /* Popup */
#popup {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  z-index: 1000;
  padding: 20px;
  color: #fff;
  background: rgba(0,0,0,0.85);
  backdrop-filter: blur(6px);
}

#popup h2 {
  margin-bottom: 20px;
  font-family: 'Cinzel', serif;
  color: #f55;
}

#popup .grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 12px;
  width: 100%;
  max-width: 800px;
  max-height: 70vh;
  overflow-y: auto;
}

#popup button {
  font-family: 'Cinzel', serif;
  font-size: 15px;
  padding: 12px;
  border-radius: 10px;
  border: 2px solid #a11;
  background: linear-gradient(180deg, #b71c1c, #7f0000);
  color: #f8f8f8;
  cursor: pointer;
  box-shadow: 0 2px 6px rgba(0,0,0,0.6);
  transition: transform 0.15s, background 0.3s;
}

#popup button:hover {
  background: linear-gradient(180deg, #d32f2f, #8b0000);
  transform: scale(1.05);
}

#popup .close-btn {
  margin-top: 20px;
  background: #444;
  border: none;
  padding: 10px 18px;
  font-size: 14px;
  border-radius: 8px;
  cursor: pointer;
}

/* Auswahl-Best√§tigung Animation */
.auswahl-bestaetigt {
  animation: highlight 0.6s ease-out;
}
@keyframes highlight {
  from { background-color: rgba(0,255,0,0.3); }
  to { background-color: transparent; }
}

/* Charakter-Icons */
.charakter-box::before {
  content: "üë§ ";
}

/* Responsive */
@media (max-width: 600px) {
  #popup .grid {
    grid-template-columns: repeat(2, 1fr);
  }
}
</style>

</head>
<body>

<h1>Trouble Brewing Dokumentation</h1>

<!-- Charakter-Auswahl -->
<div id="charakter-auswahl" class="runde-box">
  <h2 onclick="toggleBereich('charaktere-inhalt')">Charaktere ausw√§hlen</h2>
  <div id="charaktere-inhalt">
    <div id="charaktere-liste"></div>
    <button onclick="speichereCharaktere()">Auswahl speichern</button>
  </div>
</div>

<!-- Spieler-Zuweisung -->
<div id="spieler-zuweisung" class="runde-box" style="display:none;">
  <h2 onclick="toggleBereich('spieler-inhalt')">Spielernamen zuweisen</h2>
  <div id="spieler-inhalt">
    <div id="zuweisungen"></div>
    <button onclick="speichereSpieler()">Spielernamen speichern</button>
  </div>
</div>

<div id="runde-bereich" style="display:none;">
  <div class="runde-box">
    <h2 id="rundenanzeige">Runde 1</h2>
    <button onclick="neueAktion()">Aktion hinzuf√ºgen</button>
    <div id="aktionen"></div>
    <h3>Notizen</h3>
    <textarea id="notizen" rows="3" placeholder="Notizen zur Runde..."></textarea>
    <br>
    <button onclick="rundeSpeichern()">Runde speichern</button>
  </div>
</div>

<div id="popup">
  <h2 id="popup-title"></h2>
  <div class="grid" id="popup-grid"></div>
  <button class="close-btn" onclick="schliessePopup()">Abbrechen</button>
</div>

<div class="historie">
  <h2>Historie</h2>
  <div id="historie-liste"></div>
  <button onclick="rundeRueckgaengig()">Letzte Runde r√ºckg√§ngig</button>
  <button onclick="historieLoeschen()">Historie l√∂schen</button>
  <button onclick="charaktereZuruecksetzen()">Charaktere & Spielernamen zur√ºcksetzen</button>
</div>

<script>
const alleCharaktere = [
  "Waschweib","Bibliothekar","Detektiv","Koch","Empath","Wahrsagerin","Soldat",
  "Totengr√§ber","M√∂nch","Rabenh√ºter","Jungfrau","D√§monenj√§ger","B√ºrgermeister",
  "Butler","Heilige","Einsiedler","Trunkenbold","Baron","Scharlachrote Frau",
  "Spion", "Giftmischer","Imp", "Falsche F√§hrte"
];

const aktionenListe = ["nominiert", "t√∂tet", "vergiftet", "bekommt Info √ºber", "besch√ºtzt", "erschie√üt", "wird zu", "wird Butler von", "erscheint als", "stirbt"];

const aktionenProCharakter = {
  "Waschweib": ["bekommt Info √ºber"],
  "Bibliothekar": ["bekommt Info √ºber"],
  "Detektiv": ["bekommt Info √ºber"],
  "Koch": ["bekommt Info √ºber"],
  "Empath": ["bekommt Info √ºber"],
  "Wahrsagerin": ["bekommt Info √ºber"],
  "Soldat": ["besch√ºtzt"],
  "M√∂nch": ["besch√ºtzt"],
  "Giftmischer": ["vergiftet"],
  "Imp": ["t√∂tet"],
  "Butler": ["wird Butler von"]
  // F√ºgen Sie weitere Charaktere hinzu
};

let ausgewaehlteCharaktere = JSON.parse(localStorage.getItem("charaktere")) || [];
let spieler = JSON.parse(localStorage.getItem("spieler")) || {};
let historie = JSON.parse(localStorage.getItem("historie")) || [];
let runde = historie.length + 1;

// --- Zusatzfeld als Button ---
function erstelleErgaenzungsfeld() {
  const container = document.createElement("span");
  const btn = document.createElement("button");
  btn.type = "button";
  btn.textContent = "+ Erg√§nzung";
  btn.style.marginLeft = "5px";
  btn.onclick = () => {
    const input = document.createElement("input");
    input.type = "text";
    input.placeholder = "Erg√§nzung";
    input.style.marginLeft = "5px";
    container.replaceChild(input, btn);
  };
  container.appendChild(btn);
  return container;
}

// Charakter-Auswahl


function ladeCharaktere() {
  const liste = document.getElementById("charaktere-liste");
  liste.innerHTML = "";
  alleCharaktere.forEach(ch => {
    const btn = document.createElement("button");
    btn.type = "button";
    btn.textContent = ch;
    btn.className = "charakter-button";
    
    // Bereits gespeicherte Auswahl gr√ºn markieren
    if (ausgewaehlteCharaktere.includes(ch)) {
      btn.classList.add("ausgewaehlt");
    }

    btn.onclick = () => {
      if (ausgewaehlteCharaktere.includes(ch)) {
        // abw√§hlen
        ausgewaehlteCharaktere = ausgewaehlteCharaktere.filter(c => c !== ch);
        btn.classList.remove("ausgewaehlt");
      } else {
        // ausw√§hlen
        ausgewaehlteCharaktere.push(ch);
        btn.classList.add("ausgewaehlt");
      }
    };

    liste.appendChild(btn);
  });
}



function speichereCharaktere() {
  localStorage.setItem("charaktere", JSON.stringify(ausgewaehlteCharaktere));
  zeigeSpielerZuweisung();
}

function zeigeSpielerZuweisung() {
  document.getElementById("spieler-zuweisung").style.display = "block";
  const container = document.getElementById("zuweisungen");
  container.innerHTML = "";
  ausgewaehlteCharaktere.forEach(ch => {
    const label = document.createElement("label");
    label.textContent = ch + ": ";
    const input = document.createElement("input");
    input.type = "text";
    input.value = spieler[ch] || "";
    input.dataset.char = ch;
    container.appendChild(label);
    container.appendChild(input);
    container.appendChild(document.createElement("br"));
  });
}
function speichereSpieler() {
  document.querySelectorAll("#zuweisungen input").forEach(inp => {
    spieler[inp.dataset.char] = inp.value;
  });
  localStorage.setItem("spieler", JSON.stringify(spieler));
  document.getElementById("runde-bereich").style.display = "block";
  aktualisiereHistorie();

  // --- Standardaktionen f√ºr Runde 1 ---
  if (runde === 1) {
    if (ausgewaehlteCharaktere.includes("Trunkenbold")) neueAktion("Trunkenbold");
	if (ausgewaehlteCharaktere.includes("Falsche F√§hrte")) neueAktion("Falsche F√§hrte");
    if (ausgewaehlteCharaktere.includes("Giftmischer")) neueAktion("Giftmischer", "vergiftet");
    if (ausgewaehlteCharaktere.includes("Waschweib")) neueAktion("Waschweib", "bekommt Info √ºber");
	if (ausgewaehlteCharaktere.includes("Bibliothekar")) neueAktion("Bibliothekar", "bekommt Info √ºber");
	if (ausgewaehlteCharaktere.includes("Detektiv")) neueAktion("Detektiv", "bekommt Info √ºber");
	if (ausgewaehlteCharaktere.includes("Koch")) neueAktion("Koch", "bekommt Info √ºber");
	if (ausgewaehlteCharaktere.includes("Empath")) neueAktion("Empath", "bekommt Info √ºber");
	if (ausgewaehlteCharaktere.includes("Wahrsagerin")) neueAktion("Wahrsagerin", "bekommt Info √ºber");
	if (ausgewaehlteCharaktere.includes("Butler")) neueAktion("Butler", "bekommt Info √ºber");
  }
}

// Popup
let aktuellesZielFeld = null;
let popupModus = null;

function oeffnePopup(zielFeld, modus, charName = null) {
  aktuellesZielFeld = zielFeld;
  popupModus = modus;

  const title = document.getElementById("popup-title");
  const grid = document.getElementById("popup-grid");
  grid.innerHTML = "";

  let items = [];
  
  if (modus === "charakter") {
    items = ausgewaehlteCharaktere;
    title.textContent = "Charakter w√§hlen";
  } 
  else if (modus === "aktion") {
    // IMMER alle Aktionen anzeigen, unabh√§ngig vom Charakter
    items = aktionenListe;
    title.textContent = "Aktion w√§hlen";
  }

  items.forEach(item => {
    const btn = document.createElement("button");
    btn.textContent = item;
    btn.onclick = () => {
      zielFeld.value = item;
      zielFeld.classList.add("auswahl-bestaetigt");
      setTimeout(() => zielFeld.classList.remove("auswahl-bestaetigt"), 600);
      schliessePopup();
    };
    grid.appendChild(btn);
  });

  document.getElementById("popup").style.display = "flex";
}

function schliessePopup() {
  document.getElementById("popup").style.display="none";
  aktuellesZielFeld=null;
  popupModus=null;
}

function toggleBereich(id) {
  const bereich = document.getElementById(id);
  const header = bereich.previousElementSibling;
  if (bereich.style.display === "none") {
    bereich.style.display = "block";
    header.classList.remove("collapsed");
    header.classList.add("expanded");
  } else {
    bereich.style.display = "none";
    header.classList.remove("expanded");
    header.classList.add("collapsed");
  }
}

function neueAktion(vorwahlChar = null, vorwahlAktion = null) {
  const div = document.createElement("div");
  div.className = "aktion";

  // Ersetzen Sie die Select-Elemente durch Input-Felder mit Popup-Funktionalit√§t
  const feld1 = document.createElement("input");
  feld1.readOnly = true;
  feld1.placeholder = "Charakter w√§hlen‚Ä¶";
  feld1.onclick = () => oeffnePopup(feld1, "charakter");

  const feldAktion = document.createElement("input");
  feldAktion.readOnly = true;
  feldAktion.placeholder = "Aktion w√§hlen‚Ä¶";
  feldAktion.onclick = () => {
    const charName = feld1.value.split(" (")[0];
    oeffnePopup(feldAktion, "aktion", charName);
  };

  const feld2 = document.createElement("input");
  feld2.readOnly = true;
  feld2.placeholder = "Ziel w√§hlen‚Ä¶";
  feld2.onclick = () => oeffnePopup(feld2, "charakter");

  const feld3 = document.createElement("input");
  feld3.readOnly = true;
  feld3.placeholder = "Weiterer Charakter‚Ä¶";
  feld3.onclick = () => oeffnePopup(feld3, "charakter");

  // Vorbelegung wenn Parameter √ºbergeben
  if (vorwahlChar) {
    feld1.value = vorwahlChar + (spieler[vorwahlChar] ? ` (${spieler[vorwahlChar]})` : "");
  }
  if (vorwahlAktion) {
    feldAktion.value = vorwahlAktion;
  }

  // Delete-Button hinzuf√ºgen
  const delBtn = document.createElement("button");
  delBtn.textContent = "L√∂schen";
  delBtn.className = "del-btn";
  delBtn.onclick = () => { div.remove(); neuNummerieren(); };

  // Zusammenbauen
  div.appendChild(feld1);
  div.appendChild(feldAktion);
  div.appendChild(feld2);
  div.appendChild(erstelleErgaenzungsfeld());
  div.appendChild(feld3);
  div.appendChild(erstelleErgaenzungsfeld());
  div.appendChild(delBtn);

  document.getElementById("aktionen").appendChild(div);
}
function rundeSpeichern() {
  const aktionen = Array.from(document.querySelectorAll("#aktionen .aktion")).map(a => {
    const inputs = a.querySelectorAll("input");
    const [ch1, act, ch2, ch3] = Array.from(inputs).slice(0, 4); // Erste 4 Input-Felder
    const ergFields = a.querySelectorAll("input[type='text']"); // Erg√§nzungsfelder
    const erg1 = ergFields[0] ? ergFields[0].value : "";
    const erg2 = ergFields[1] ? ergFields[1].value : "";
    return `${ch1.value} ${act.value} ${ch2.value} ${erg1} ${ch3.value} ${erg2}`;
  });
  const notizen = document.getElementById("notizen").value;
  historie.push({runde, aktionen, notizen});
  localStorage.setItem("historie", JSON.stringify(historie));
  runde++;
  document.getElementById("rundenanzeige").textContent = "Runde " + runde;
  document.getElementById("aktionen").innerHTML = "";
  document.getElementById("notizen").value = "";
  aktualisiereHistorie();

  // --- Standardaktionen ab Runde 2 ---
  if (runde >= 2) {
    if (ausgewaehlteCharaktere.includes("Giftmischer")) neueAktion("Giftmischer", "vergiftet");
    if (ausgewaehlteCharaktere.includes("M√∂nch")) neueAktion("M√∂nch", "besch√ºtzt");
	if (ausgewaehlteCharaktere.includes("Imp")) neueAktion("Imp", "t√∂tet");
	if (ausgewaehlteCharaktere.includes("Rabenh√ºter")) neueAktion("M√∂nch", "besch√ºtzt");
	if (ausgewaehlteCharaktere.includes("Empath")) neueAktion("Empath", "bekommt Info √ºber");
	if (ausgewaehlteCharaktere.includes("Wahrsagerin")) neueAktion("Wahrsagerin", "bekommt Info √ºber");
	if (ausgewaehlteCharaktere.includes("Totengr√§ber")) neueAktion("Totengr√§ber", "bekommt Info √ºber");
	if (ausgewaehlteCharaktere.includes("Butler")) neueAktion("Butler", "wird Butler von");
  }
}

// Historie verwalten
function aktualisiereHistorie() {
  const liste = document.getElementById("historie-liste");
  liste.innerHTML = "";
  historie.forEach(h => {
    const div = document.createElement("div");
    div.className = "runde-box";
    div.innerHTML = `<h3>Runde ${h.runde}</h3>
      <ul>${h.aktionen.map(a => `<li>${a}</li>`).join("")}</ul>
      <p><strong>Notizen:</strong> ${h.notizen}</p>`;
    liste.appendChild(div);
  });
}


function rundeRueckgaengig() {
  if (historie.length > 0 && confirm("Letzte Runde wirklich l√∂schen?")) {
    historie.pop();
    localStorage.setItem("historie", JSON.stringify(historie));
    runde = historie.length + 1;
    document.getElementById("rundenanzeige").textContent = "Runde " + runde;
    aktualisiereHistorie();
  }
}
function historieLoeschen() {
  if (confirm("Gesamte Historie wirklich l√∂schen?")) {
    historie = [];
    localStorage.removeItem("historie");
    runde = 1;
    document.getElementById("rundenanzeige").textContent = "Runde " + runde;
    aktualisiereHistorie();
  }
}
function charaktereZuruecksetzen() {
  if (confirm("Charaktere und Spielernamen wirklich zur√ºcksetzen?")) {
    localStorage.removeItem("charaktere");
    localStorage.removeItem("spieler");
    ausgewaehlteCharaktere = [];
    spieler = {};
    location.reload();
  }
}

// Initial laden
ladeCharaktere();
if (ausgewaehlteCharaktere.length > 0) zeigeSpielerZuweisung();
if (Object.keys(spieler).length > 0) document.getElementById("runde-bereich").style.display = "block";
aktualisiereHistorie();
</script>



</body>
</html>
